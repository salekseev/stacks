# $schema: https://raw.githubusercontent.com/compose-spec/compose-spec/refs/heads/main/schema/compose-spec.json

services:

  cloudflared:
    image: cloudflare/cloudflared:2026.1.2
    container_name: cloudflared
    command: --config /etc/cloudflared/config.yml tunnel run
    user: 568:568
    configs:
      - source: cloudflared
        target: /etc/cloudflared/config.yml
        uid: "568"
        gid: "568"
        mode: 0440
    volumes:
      - /mnt/spool/apps/config/cloudflared:/etc/cloudflared
    networks:
      - cloudflare
    restart: unless-stopped

  sabnzbd:
    container_name: sabnzbd
    image: ghcr.io/hotio/sabnzbd:release-4.5.5
    env_file:
      - stack.env
    volumes:
      - /mnt/spool/apps/config/sabnzbd:/config
      - /mnt/dpool/media:/media
    expose:
      - "8080"
    networks:
      - cloudflare
    restart: unless-stopped

  qbittorrent:
    image: ghcr.io/hotio/qbittorrent:release-5.1.4
    container_name: qbittorrent
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    env_file:
      - stack.env
    environment:
      - LIBTORRENT=v1
      - VPN_ENABLED=true
      - VPN_PROVIDER=pia
      - VPN_PIA_USER=${PIA_USERNAME}
      - VPN_PIA_PASS=${PIA_PASSWORD}
      - VPN_PIA_PREFERRED_REGION=ca
      - VPN_AUTO_PORT_FORWARD=true
      - VPN_PIA_PORT_FORWARD_PERSIST=true
    volumes:
      - /mnt/spool/apps/config/qbittorrent:/config
      - /mnt/dpool/media:/media
    expose:
      - "8080"
    networks:
      - cloudflare
    restart: unless-stopped

  qui:
    image: ghcr.io/hotio/qui:release-v1.13.1
    container_name: qui
    env_file:
      - stack.env
    volumes:
      - /mnt/spool/apps/config/qbittorrent:/config
      - /mnt/dpool/media:/media
    expose:
      - "7476"
    depends_on:
      - qbittorrent
    networks:
      - cloudflare
    restart: unless-stopped

  autobrr:
    image: ghcr.io/s0up4200/autobrr-distroless:v1.72.1
    container_name: autobrr
    user: nobody
    env_file:
      - stack.env
    environment:
      - AUTOBRR__CHECK_FOR_UPDATES=false
    volumes:
      - /mnt/spool/apps/config/autobrr:/config
    expose:
      - "7474"
    depends_on:
      - qbittorrent
    networks:
      - cloudflare
    restart: unless-stopped

  prowlarr:
    image: ghcr.io/hotio/prowlarr:release-2.3.0.5236
    container_name: prowlarr
    restart: unless-stopped
    env_file:
      - stack.env
    volumes:
      - /mnt/spool/apps/config/prowlarr:/config
      - /mnt/dpool/media:/media
    expose:
      - "9696"
    depends_on:
      - byparr
    networks:
      - cloudflare

  byparr:
    image: ghcr.io/thephaseless/byparr:latest
    container_name: byparr
    env_file:
      - stack.env
    expose:
      - "8191"
    networks:
      - cloudflare
    restart: unless-stopped

  radarr:
    image: ghcr.io/hotio/radarr:release-6.0.4.10291
    container_name: radarr
    env_file:
      - stack.env
    volumes:
      - /mnt/spool/apps/config/radarr:/config
      - /mnt/dpool/media:/media
    expose:
      - "7878"
    depends_on:
      - prowlarr
    networks:
      - cloudflare
    restart: unless-stopped

  sonarr:
    image: ghcr.io/hotio/sonarr:release-4.0.16.2944
    container_name: sonarr
    env_file:
      - stack.env
    volumes:
      - /mnt/spool/apps/config/sonarr:/config
      - /mnt/dpool/media:/media
    expose:
      - "8989"
    depends_on:
      - prowlarr
    networks:
      - cloudflare
    restart: unless-stopped

  unpackerr:
    image: ghcr.io/hotio/unpackerr:release-0.14.5
    container_name: unpackerr
    env_file:
      - stack.env
    volumes:
      - /mnt/spool/apps/config/unpackerr:/config
      - /mnt/dpool/media:/media
    depends_on:
      - radarr
      - sonarr
    networks:
      - cloudflare
    restart: unless-stopped

  recyclarr:
    image: ghcr.io/recyclarr/recyclarr:7.5.2
    container_name: recyclarr
    user: 1000:1000
    env_file:
      - stack.env
    environment:
      - CRON_SCHEDULE=@daily
    volumes:
      - /mnt/spool/apps/config/recyclarr:/config:ro
    depends_on:
      - radarr
      - sonarr
    networks:
      - cloudflare
    restart: unless-stopped

configs:
  cloudflared:
    content: |
      tunnel: 08942756-aeb6-45dc-aaaa-5ff4ee5a0475
      credentials-file: /etc/cloudflared/creds/08942756-aeb6-45dc-aaaa-5ff4ee5a0475.json
      ingress:
        - hostname: prowlarr.alekseev.us
          service: http://prowlarr:9696
          access:
            required: true
            teamName: alekseev
            audTag:
              - 28301c1e32ae3464a9017afc913e4770a0092631d412ad8144395add357c87c5
        - hostname: radarr.alekseev.us
          service: http://radarr:7878
          access:
            required: true
            teamName: alekseev
            audTag:
              - 6907f3d06f86c26e1fb7b26b75470ac1aa3f8b6cd60ba8df7b370fe8406669e9
        - hostname: sonarr.alekseev.us
          service: http://sonarr:8989
          access:
            required: true
            teamName: alekseev
            audTag:
              - 00d9b88538ea4d3f73429e864dc9a163ae0199d6224fb1c2550de2c869f9885d
        - hostname: sabnzbd.alekseev.us
          service: http://sabnzbd:8080
          access:
            required: true
            teamName: alekseev
            audTag:
              - 42bf6be4522ccc467f7ec8b00e8cf3210ebf38282a1587ec215681555f76a7e3
        - hostname: qbittorrent.alekseev.us
          service: http://qbittorrent:8080
          access:
            required: true
            teamName: alekseev
            audTag:
              - fe3a5b3ffaf1bee8daaaac9d32dd54757691c92ded80e00e57855bcfa6573bb3
        - hostname: qui.alekseev.us
          service: http://qui:7476
        - hostname: autobrr.alekseev.us
          service: http://autobrr:7474
        - service: http_status:404

networks:
  cloudflare:
    name: cloudflare
